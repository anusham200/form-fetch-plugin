<div style="display: flex; justify-content: space-between; align-items: flex-start; width: 100%;">
    <div style="width: 48%; text-align: left; margin-top: -325px; margin-left: auto;">
        <h2>Custom Form</h2>
        <form id="custom-form" method="post" action="<?php echo $block->getFormActionUrl(); ?>" style="text-align: left;">
            <?php echo $block->getFormKeyHtml(); ?> <!-- Include Form Key -->

            <label for="email">Email ID:</label><br>
            <input type="email" id="email" name="email" placeholder="Enter your email" required><br><br>

            <label for="firstname">First Name:</label><br>
            <input type="text" id="firstname" name="firstname" placeholder="Enter your first name" required><br><br>

            <label for="lastname">Last Name:</label><br>
            <input type="text" id="lastname" name="lastname" placeholder="Enter your last name" required><br><br>

            <label for="schoolname">School Name:</label><br>
            <input type="text" id="schoolname" name="schoolname" placeholder="Enter your school name" required><br><br>

            <button type="submit" style="background-color: rgb(0,105,169); color: white; border: none; padding: 10px 20px; cursor: pointer;">Submit</button><br><br>

            <h3>Fetch Details</h3>
            <label for="fetch_email">Fetch:</label><br>
            <input type="email" id="fetch_email" name="fetch_email" placeholder="Enter email for fetch" style="border: 1px solid #ddd; padding: 8px; width: 100%;" required><br><br>
            <button type="button" id="fetch-details" style="background-color: rgb(0,105,169); color: white; border: none; padding: 10px 20px; cursor: pointer;">Fetch Details</button><br><br>
        </form>

        <div id="fetch-result"></div>
        
        <p><?php echo $block->getSuccessMessage(); ?></p>
    </div>
</div>

<script>
document.getElementById('fetch-details').addEventListener('click', function() {
    var fetchEmail = document.getElementById('fetch_email').value;
    if (fetchEmail) {
        // Send AJAX request to fetch user details
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "<?php echo $block->getUrl('formfetch/actions/fetch'); ?>", true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        xhr.onload = function () {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                var resultDiv = document.getElementById('fetch-result');
                
                if (response.success) {
                    resultDiv.innerHTML = `
                        <p><strong>Email:</strong> ${response.data.email}</p>
                        <p><strong>First Name:</strong> ${response.data.first_name}</p>
                        <p><strong>Last Name:</strong> ${response.data.last_name}</p>
                        <p><strong>School Name:</strong> ${response.data.school_name}</p>
                    `;
                } else {
                    resultDiv.innerHTML = `<p>${response.message}</p>`;
                }
            } else {
                console.error("Error fetching user details.");
            }
        };

        xhr.send("fetch_email=" + encodeURIComponent(fetchEmail));
    } else {
        alert("Please enter an email to fetch details.");
    }
});
</script>
